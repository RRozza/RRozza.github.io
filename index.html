<!DOCTYPE html>
<html>
    <head>
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <style>
            body { background: #000000; overflow: hidden; }
            canvas { display: block; }
        </style>

        <title>Baking</title>
    </head>
    <body>
        <canvas id="webgl" class="buffer"></canvas>

        <script type="text/javascript" src="thirdparty/js/three.min.js"></script>
        <script type="text/javascript" src="thirdparty/js/OrbitControls.js"></script>
        <script type="text/javascript" src="thirdparty/js/OBJLoader.js"></script>

        <script>
            var _camera = null;
            var _scene = null;
            var _renderer = null;
            var _controls = null;

            function init () {
                _scene = new THREE.Scene();

                var ambientLight = new THREE.AmbientLight(0xFFFFFF, 1);
                _scene.add(ambientLight);

                var canvas = document.getElementById('webgl');
                _renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
                _renderer.setPixelRatio(1);
                _renderer.setSize(window.innerWidth, window.innerHeight, true);
                _renderer.setViewport(0, 0, window.innerWidth, window.innerHeight);
                _renderer.setClearColor(0x000000, 0);
            };

            var render = function () {
                _renderer.render(_scene, _camera);
            };

            var animate = function () {
                requestAnimationFrame(animate);
                _controls.update();
                render();
            };

            function setCamera (data) {
                var filmSize = 27;
                var focalLength = 35;
                var fov = 2.0*180.0/Math.PI*Math.atan(0.5*filmSize/focalLength);

                _camera = new THREE.PerspectiveCamera(fov,  window.innerWidth/window.innerHeight, 0.02, 1000);
                _camera.position.set(data.origin[0], data.origin[1], data.origin[2]);

                var target = new THREE.Vector3(data.target[0], data.target[1], data.target[2]);
                _camera.lookAt(target);

                _controls = new THREE.OrbitControls(_camera);
                _controls.addEventListener('change', render);

                animate();
            };

            function loadEntity (name) {
                var texLoader = new THREE.TextureLoader();
                texLoader.load(name + '.png', function(tex) {
                    var material = new THREE.MeshBasicMaterial({ map: tex });
                    var objLoader = new THREE.OBJLoader();
                    objLoader.load(name + '.obj', function(obj) {
                        var mesh = obj.children[0];
                        mesh.material = material;
                        _scene.add(mesh);
                    });
                });
            };

            function getParameterByName(name, url) {
                if (!url)
                    url = window.location.href;

                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
                var results = regex.exec(url);

                if (!results)
                    return null;

                if (!results[2])
                    return '';

                return decodeURIComponent(results[2].replace(/\+/g, " "));
            };

            init();
            
            var value = getParameterByName("scene");
            if (value === "Room") {
                setCamera({ origin: [-20.0, 15.0, -20.0], target: [0.0, 0.0, 0.0] });
                [
                    '/images/Room00125', '/images/Room00255', '/images/Room01250',
                    '/images/Room02550', '/images/Room12500', '/images/Room014050',
                    '/images/Room017050', '/images/Room25500', '/images/Room120500',
                    '/images/Room0125125', '/images/Room0125255', '/images/Room125500',
                    '/images/Room140050', '/images/Room170500', '/images/Room0255125',
                    '/images/Room500125', '/images/Room500140', '/images/Room500170',
                    '/images/Room500255', '/images/Room501200', '/images/Room501250',
                    '/images/Room1250125', '/images/Room1251250', '/images/Room1252550',
                    '/images/Room1700170', '/images/Room1701700', '/images/Room1702550',
                    '/images/Room2550120', '/images/Room2550125', '/images/Room2551250',
                    '/images/Room2551800', '/images/Room2552550', '/images/Room5017050',
                    '/images/Room5025550', '/images/Room5050170', '/images/Room5050255',
                    '/images/Room25550170', '/images/Room50170170', '/images/Room130255190'
                ].forEach(function (e) {
                    loadEntity(e);
                });
            } else {
                setCamera({ origin: [0.4, 0.4, 0.4], target: [0.0, 0.0, 0.0] });
                [
                    '/images/Puma025550', '/images/Puma050255', '/images/Puma0125125',
                    '/images/Puma0125255', '/images/Puma255050', '/images/Puma255500',
                    '/images/Puma500255', '/images/Puma502550', '/images/Puma1010255',
                    '/images/Puma1025510', '/images/Puma1250255', '/images/Puma1252550',
                    '/images/Puma2551010', '/images/Puma10255255', '/images/Puma25510125',
                    '/images/Puma25510255', '/images/Puma25512510', '/images/Puma50100200',
                    '/images/Puma125125125', '/images/Puma125125255', '/images/Puma125255125',
                    '/images/Puma250250250'
                ].forEach(function (e) {
                    loadEntity(e);
                });
            }

        </script>
</html>
